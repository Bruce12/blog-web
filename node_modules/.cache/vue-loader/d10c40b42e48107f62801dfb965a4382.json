{"remainingRequest":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lanjianhua/Desktop/lanjianhua/myMusic/src/components/Popup/components/Popup.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/src/components/Popup/components/Popup.vue","mtime":1575252846557},{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lanjianhua/Desktop/lanjianhua/myMusic/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Prop, Watch, Vue } from 'vue-property-decorator'\nimport { getPosition, getStyle, animate } from '@/utils/dom'\n// import api from '../api'\n@Component({\n  name: 'PopupUserBox',\n  components: {\n  }\n})\nexport default class extends Vue {\n  @Prop({ default: [] }) private options!: Array<string>\n  @Prop({ default: {} }) private data!: any\n  @Prop() private overwriteConf!: any\n  @Prop({ default: 'absolute' }) private position!: string\n  @Prop({ default: true, type: Boolean }) private show!: boolean\n  @Prop({ default: false, type: Boolean }) private isShowTelephone!: boolean\n  @Prop({ default: 9999 }) private zIndex!: number\n  private left: number = 0\n  private top: number = 0\n  private shellWidth: number = 0\n  private shellHeight: number = 0\n  private shellTop: number= 0\n  private shellLeft: number = 0\n  private defaultOptions: Array<string> = ['phone', 'truck', 'user', 'wechat', 'archive', 'buyer', 'seller']\n  private endTimer: any = null\n  private target: any = ''\n  private preventClick: boolean = true\n  private startTimer: any = null\n  private config = {\n    phone: {\n      icon: 'icon-phone',\n      text: '打电话'\n    },\n    user: {\n      icon: 'icon-user',\n      text: '用户详细信息'\n    },\n    archive: {\n      icon: 'icon-archive',\n      text: '线索认领'\n    },\n    buyer: {\n      icon: 'icon-buyer',\n      text: '买家详情'\n    },\n    wechat: {\n      icon: 'icon-wechat',\n      text: '微信'\n    },\n    truck: {\n      icon: 'icon-truck',\n      text: '物流'\n    },\n    yen: {\n      icon: 'icon-yen',\n      text: '线索交易订单'\n    },\n    seller: {\n      icon: 'icon-seller',\n      text: '卖家详情'\n    },\n    email: {\n      icon: 'icon-email',\n      text: '邮箱'\n    }\n  }\n  @Watch('$route')\n  private onRoute(val: any) {\n    this.mouseleave()\n  }\n  @Watch('position')\n  private onPositionChange(val: string) {\n    if (val) this.$emit('update:position', val)\n  }\n  mounted() {\n    this.$nextTick(() => {\n      this.target = this.$refs.myPopup as HTMLDivElement\n      document.body.appendChild(this.$refs.myPopupBox as HTMLElement)\n    })\n  }\n  created() {\n    this.init()\n    this.singleton()\n  }\n  destroyed() {\n    if (this.show) {\n      this.$emit('update:show', false)\n    }\n  }\n  //\n  private init() {\n    const overwriteConf = this.overwriteConf\n    if (!overwriteConf || !overwriteConf.length) {\n      this.options.forEach((item: string, inx: number) => {\n        if (!this.defaultOptions.includes(item)) {\n          this.defaultOptions.push(item)\n        }\n      })\n    } else {\n      this.defaultOptions = this.overwriteConf\n    }\n  }\n  private mouseleave() {\n    clearTimeout(this.startTimer)\n    setTimeout(() => {\n      this.$emit('update:show', false)\n      this.preventClick = true\n    }, 500)\n  }\n  private handleAction(evName: string) {\n    if (!evName || this.preventClick) {\n      return null\n    }\n    const data = this.data\n    const baseUrl = location.href.replace(location.hash, '')\n    switch (evName) {\n      case 'wechat':\n        if (!data.id) return null\n        this.$router.push({ name: 'relationship', query: { userId1: data.id } })\n        break\n      // 认领\n      case 'archive':\n        if (!data.id) return null\n        // api.saveTags([data.id])\n        //   .then((res: any) => {\n        //     this.$message({\n        //       message: res.success ? '认领线索成功' : res.message,\n        //       type: res.success ? 'success' : 'error'\n        //     })\n        //   })\n        break\n      case 'user':\n        if (!data.id) return null\n        // this.$router.push({ name: 'uc', query: { id: data.id } })\n        window.open(`${baseUrl}#/uc?id=${data.id}`, '_blank')\n        break\n      case 'buyer':\n        if (!data.id) return null\n        // this.$router.push({ name: 'buyerInfo', query: { cId: data.id } })\n        window.open(`${baseUrl}#/buyerInfo?cId=${data.id}`, '_blank')\n        break\n      case 'truck':\n        if (!data.id) return null\n        // this.$router.push({ name: 'supplyManage', query: { id: data.id1 } })\n        window.open(`${baseUrl}#/supply/manage?id=${data.id}`, '_blank')\n        break\n      case 'phone':\n        // 拨打电话\n        if (!this.isShowTelephone) this.$emit('update:isShowTelephone', true)\n        break\n      case 'yen':\n        if (!data.id) return null\n        // this.$router.push({ name: 'tradeManage', query: { id: data.id } })\n        window.open(`${baseUrl}#/trade/orderlist?id=${data.id}`)\n        break\n      case 'seller':\n        if (!data.id) return null\n        // this.$router.push({ name: 'seller_info', query: { cId: data.id } })\n        window.open(`${baseUrl}#/seller_info?cId=${data.id}`)\n        break\n    }\n  }\n  private setPosition(el: HTMLDivElement, position: string) {\n    let resDom = { x: 0, y: 0 }\n    if (position === 'fixed') {\n      resDom.x = el.getBoundingClientRect().left\n      resDom.y = el.getBoundingClientRect().top\n    } else {\n      resDom = getPosition(el)\n    }\n    // 查找父亲元素的 position\n    this.top = 20\n    this.shellWidth = getStyle(el, 'width')\n    this.shellHeight = getStyle(el, 'height')\n    this.shellTop = resDom.y\n    this.shellLeft = resDom.x\n    ;(this.$el as HTMLDivElement).style.display = 'block'\n    this.startTimer = setTimeout(() => {\n      animate(this.target, { opacity: 1, top: this.top - 50 }, () => {\n        this.preventClick = false\n      })\n    }, 900)\n  }\n  // 单例模式\n  private singleton() {\n    this.$root.$emit('oncePopup', this)\n    const oncePopup = (page: any) => {\n      this.$root.$off('oncePopup', oncePopup)\n      if (page !== this) {\n        this.$emit('update:show', false)\n      }\n    }\n    this.$root.$on('oncePopup', oncePopup)\n  }\n}\n",null]}